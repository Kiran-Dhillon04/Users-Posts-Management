<div class="container mt-4">
  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center my-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>


  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error" >
    <!-- Filters Section -->
  <div class="bg-light p-3 rounded shadow-sm mb-4">
    <div class="row g-3 align-items-centervere">
      <!-- Search Box -->
      <div class="col-md">
        <input
          type="text"
          class="form-control"
          placeholder="Search by name or email..."
          [(ngModel)]="searchTerm"
        />
      </div>

      <!-- Gender Filter -->
      <div class="col-md">
        <select class="form-select" [(ngModel)]="genderFilter">
          <option value="">All Genders</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>

      <!-- Age Filter -->
      <div class="col-md">
        <select class="form-select" [(ngModel)]="ageFilter">
          <option value="">All Ages</option>
          <option value="below30">Below 30</option>
          <option value="30to40">30 - 40</option>
          <option value="40to50">40 - 50</option>
          <option value="50to60">50 - 60</option>
          <option value="above60">Above 60</option>
        </select>
      </div>

      <div class="col-md-auto">
        <button type="button" class="btn btn-primary " routerLink="/add-user" >+ Add User</button>
      </div>
    </div>
  </div>
</div>


  <!-- Users Table -->
  <div class="table-responsive shadow-sm rounded">
    <table
      *ngIf="!loading && !error"
      class="table table-striped table-hover table-bordered align-middle "
    >
      <thead class="table-dark text-center">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th (click)="sortData('age')" style="cursor: pointer">
            Age
            <span class="small">
              {{ sort === "age" ? (sortDirection === "asc" ? "↑" : "↓") : "↕" }}
            </span>
          </th>
          
          <th>Gender</th>
          <th (click)="sortData('phone')" style="cursor: pointer">
            Phone
            <span class="small">
              {{
                sort === "phone" ? (sortDirection === "asc" ? "↑" : "↓") : "↕"
              }}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers()">
          <td class="text-center">{{ user.id }}</td>
          <td>{{ user.firstName }} {{ user.lastName }}</td>
          <td>{{ user.email }}</td>
          <td
            class="text-center fw-bold"
            [ngStyle]="{ color: getAge(user.birthDate) < 50 ? 'red' : 'green' }"
          >
            {{ getAge(user.birthDate) }}
          </td>
          <td class="text-capitalize text-center">{{ user.gender }}</td>
          <td>{{ user.phone }}</td>

          <!-- Action Buttons -->
          <td class="text-center">
            <a
              class="btn btn-sm btn-outline-dark me-1"
              [routerLink]="['/users-detail', user.id]"
              >Detail</a
            >
            <button
              class="btn btn-sm btn-outline-primary me-1"
              (click)="editUser(user)"
            >
              Edit
            </button>
            <button
              class="btn btn-sm btn-outline-danger"
              (click)="deleteUser(user.id)"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
   <div *ngIf="!loading&&!error">
      <nav *ngIf="totalPages().length > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li
        class="page-item"
        [class.disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)"
      >
        <span class="page-link">Previous</span>
      </li>

      <li
        *ngFor="let page of totalPages()"
        [class.active]="page === currentPage"
        (click)="changePage(page)"
      >
        <span class="page-link">{{ page }}</span>
      </li>

      <li
        class="page-item"
        [class.disabled]="currentPage === totalPages().length"
        (click)="changePage(currentPage + 1)"
      >
        <span class="page-link">Next</span>
      </li>
    </ul>
  </nav>
   </div>
</div>

<!-- ✅AddUserComponent with Modal Form  -->
<app-add-user
  *ngIf="showModal"
  [userData]="selectedUser"
  [isModal]="true"
  (closeModal)="closeModal()"
>
</app-add-user>
